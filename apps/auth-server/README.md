# Auth Server

## 개요

사용자 등록, 로그인, 토큰 갱신, 로그아웃과 같은 인증 관련 기능과 사용자 활동 로깅 기능을 제공합니다.

## 주요 모듈

### Auth 모듈

사용자 인증 관련 기능을 담당합니다.

- **인증 서비스 (auth.service.ts)**
  - `register`: 새 사용자 등록 및 초기 토큰 발급
  - `login`: 사용자 로그인 및 토큰 발급
  - `refresh`: 리프레시 토큰을 사용한 액세스 토큰 재발급
  - `logout`: 사용자 로그아웃 및 토큰 무효화

### User 모듈

사용자 정보 관리 기능을 담당합니다.

- **사용자 서비스 (user.service.ts)**
  - 사용자 생성, 조회, 업데이트 기능
  - 관리자 계정 생성 및 관리
  - 사용자 역할(Role) 관리
  - 리프레시 토큰 관리

### User Activity 모듈

사용자 활동 로깅 기능을 담당합니다.

- **사용자 활동 서비스 (user-activity.service.ts)**
  - 사용자 로그인, 초대 등의 활동 기록
  - 사용자별 활동 이력 조회

## API 엔드포인트

Auth Server는 TCP 기반 마이크로서비스로서 직접적인 HTTP 엔드포인트를 노출하지 않습니다. 대신 메시지 패턴을 통해 Gateway Server와 통신합니다.

### 주요 메시지 패턴

- `auth_register`: 신규 사용자 등록
- `auth_login`: 사용자 로그인
- `auth_refresh`: 토큰 갱신
- `auth_logout`: 로그아웃
- `user_activity_create_user_activity`: 사용자 활동 기록
- `user_activity_get_user_activities`: 사용자 활동 조회

## 보안 특징

- **JWT 인증**: 액세스 토큰과 리프레시 토큰 기반 인증
- **비밀번호 암호화**: bcrypt를 사용한 안전한 비밀번호 해싱
- **토큰 블랙리스트**: 로그아웃 시 리프레시 토큰 무효화
- **역할 기반 접근 제어**: 사용자 역할에 따른 권한 관리

## 동시성 및 원자성

- **MongoDB 원자적 연산**: 데이터베이스 수준에서 동시성 문제 해결
- **이메일 중복 방지**: 유니크 인덱스와 원자적 생성 연산을 통한 동시 등록 방지
- **안전한 토큰 관리**: 원자적 업데이트 연산을 통한 토큰 관리
